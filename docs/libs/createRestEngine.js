const createRestEngine=function(t){const{bank:e,parseCurl:a}=t,r=function(){let t=0;return()=>{if(t>46549)throw"Too many calls";const e=42641*(t+1001)%46549,a=29*t%36;return t++,a.toString(36)+e.toString(36).padStart(3,"0")}}(),n=function(){async function t(t){const e=t;return new Promise((async function(a){"0"===localStorage.getItem("lock")?(localStorage.setItem("lock",e),await async function(t){return new Promise((e=>setTimeout(e,t)))}(100),localStorage.getItem("lock")===e?(localStorage.setItem(localStorage.length-1,t),localStorage.setItem("lock","0"),a(!0)):a(!1)):a(!1)}))}null==localStorage.getItem("lock")&&localStorage.setItem("lock","0");const e=async function(e){return t(JSON.stringify({text:e,timestamp:a()}))},a=function(){return(new Date).toISOString()};return{store:e,getCurrentISODate:a,setTimeMachineOn:function(t){n.store=function(){},n.getCurrentISODate=function(){return t}},setTimeMachineOff:function(){n.store=e,n.getCurrentISODate=a}}}();function i(t){return 2===t.length&&"AF-AX-AL-DZ-AS-AD-AO-AI-AQ-AG-AR-AM-AW-AU-AT-AZ-BS-BH-BD-BB-BY-BE-BZ-BJ-BM-BT-BO-BA-BW-BV-BR-IO-BN-BG-BF-BI-KH-CM-CA-CV-KY-CF-TD-CL-CN-CX-CC-CO-KM-CG-CD-CK-CR-CI-HR-CU-CY-CZ-DK-DJ-DM-DO-EC-EG-SV-GQ-ER-EE-ET-FK-FO-FJ-FI-FR-GF-PF-TF-GA-GM-GE-DE-GH-GI-GR-GL-GD-GP-GU-GT-GG-GN-GW-GY-HT-HM-VA-HN-HK-HU-IS-IN-ID-IR-IQ-IE-IM-IL-IT-JM-JP-JE-JO-KZ-KE-KI-KR-KP-KW-KG-LA-LV-LB-LS-LR-LY-LI-LT-LU-MO-MK-MG-MW-MY-MV-ML-MT-MH-MQ-MR-MU-YT-MX-FM-MD-MC-MN-ME-MS-MA-MZ-MM-NA-NR-NP-NL-AN-NC-NZ-NI-NE-NG-NU-NF-MP-NO-OM-PK-PW-PS-PA-PG-PY-PE-PH-PN-PL-PT-PR-QA-RE-RO-RU-RW-BL-SH-KN-LC-MF-PM-VC-WS-SM-ST-SA-SN-RS-SC-SL-SG-SK-SI-SB-SO-ZA-GS-ES-LK-SD-SR-SJ-SZ-SE-CH-SY-TW-TJ-TZ-TH-TL-TG-TK-TO-TT-TN-TR-TM-TC-TV-UG-UA-AE-GB-US-UM-UY-UZ-VU-VE-VN-VG-VI-WF-EH-YE-ZM-ZW".indexOf(t.toUpperCase())%3==0}function o(t){return/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t)}function s(t){if(t.startsWith("/GB/")){const e=t.indexOf("/",4);if(-1===e)return;const a=t.indexOf("/",e+1);if(-1===a)return;return{country:"GB",line:t.substring(4,e),city:t.substring(e+1,a),zip:t.substring(a+1)}}if(t.startsWith("/US/")){const e={AL:"Alabama",AK:"Alaska",AS:"American Samoa",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District Of Columbia",FM:"Federated States Of Micronesia",FL:"Florida",GA:"Georgia",GU:"Guam",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MH:"Marshall Islands",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",MP:"Northern Mariana Islands",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PW:"Palau",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VI:"Virgin Islands",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},a=t.indexOf("/",4);if(-1===a)return;const r=t.indexOf("/",a+1);if(-1===r)return;const n=t.indexOf("/",r+1);if(-1===n)return;const i=t.substring(4,a),o=t.substring(a+1,r),s=t.substring(r+1,n),u=t.substring(n+1);if(void 0===e[s])return;if(!1===/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(u))return;return{country:"US",line:i,city:o,area:s,zip:u}}}function u(t){return 0!==t.length&&!/\d/.test(t)}function d(t){if(!t.match(/^\d{4}-\d{2}-\d{2}$/))return!1;const e=new Date(t),a=e.getTime();return!(!a&&0!==a)&&(!(e.getUTCFullYear()<1900)&&(!(e.getUTCFullYear()>2006)&&e.toISOString().slice(0,10)===t))}function c(t){if(!1===/^\d+$/.test(t))return!1;if(0===t.charAt(0)&&0!==t.length)return!1;return+t<999999999}function l(t,e,a){return{httpStatusCode:400,payload:{errorCode:t,message:e,additionalInfo:a}}}function m(t){return{httpStatusCode:404,payload:{message:t}}}function f(t){return{httpStatusCode:200,payload:t}}const p=async function(t){const{url:a,method:p,data:y,text:g}=t;"get"===p&&void 0!==y&&l(0,"data is not allowed for this method",{method:p,data:y}),"delete"===p&&void 0!==y&&l(0,"data is not allowed for this method",{method:p,data:y});let I=a;if(a.startsWith("https://")&&(I=a.substring(8)),a.startsWith("http://")&&(I=a.substring(7)),a.endsWith("/")&&(I=I.substring(0,I.length-1)),"api.51bank.io/instructions"===I&&"get"===p)return function(){const t=[];for(let e=0;e<localStorage.length-1;e++)t.push(JSON.parse(localStorage.getItem(e)));return f({objectType:"collection",contents:t})}();if("api.51bank.io/customers"===I&&"get"===p)return f({objectType:"collection",contents:e.customers});if("api.51bank.io/customers"===I&&"post"===p)return async function(t,a){if(void 0===t)return l(0,"Missing all parameters to create a new customer");t.email&&(t.email=t.email.toLowerCase());for(let e in t)if("firstName"!==e&&"middleName"!==e&&"lastName"!==e&&"email"!==e&&"nationality"!==e&&"dateOfBirth"!==e&&"address"!==e)return l(0,"Invalid parameter in data",e);if(void 0===t.firstName)return l(0,"Missing Mandatory parameter",{parameter:"firstName"});if(void 0===t.lastName)return l(0,"Missing Mandatory parameter",{parameter:"lastName"});if(void 0===t.email)return l(0,"Missing Mandatory parameter",{parameter:"email"});if(void 0===t.nationality)return l(0,"Missing Mandatory parameter",{parameter:"nationality"});if(void 0===t.dateOfBirth)return l(0,"Missing Mandatory parameter",{parameter:"dateOfBirth"});if(void 0===t.address)return l(0,"Missing Mandatory parameter",{parameter:"address"});if(!1===u(t.firstName))return l(0,"Invalid Value for parameter",{parameter:"firstName"});if(void 0!==t.middleName&&!1===u(t.middleName))return l(0,"Invalid Value for parameter",{parameter:"middleName"});if(!1===u(t.lastName))return l(0,"Invalid Value for parameter",{parameter:"lastName"});if(!1===o(t.email))return l(0,"Invalid Value for parameter",{parameter:"email"});if(!1===i(t.nationality))return l(0,"Invalid Value for parameter",{parameter:"nationality"});if(!1===d(t.dateOfBirth))return l(0,"Invalid Value for parameter",{parameter:"dateOfBirth"});if(void 0===s(t.address))return l(0,"Invalid Value for parameter",{parameter:"address"});const c=e.customers.find((e=>e.email===t.email));if(void 0!==c)return l(0,"email already used by another customer",{email:c.person.email});if(!1===await n.store(a))return{httpStatusCode:503,payload:{message:"localStorage is busy. Please try again later"}};const m=n.getCurrentISODate(),p="cu_"+r(),y={id:p,objectType:"customer",type:"person",url:"https://api.51bank.io/customers/"+p,status:"created",createdAt:m,updatedAt:m,firstName:t.firstName,middleName:t.middleName,lastName:t.lastName,email:t.email,nationality:t.nationality,dateOfBirth:t.dateOfBirth,address:s(t.address)};return e.customers.push(y),f(y)}(y,g);if(I.startsWith("api.51bank.io/customers/")){const t=I.substring(24);if("get"===p)return function(t){const a=e.customers.find((e=>e.id===t));return void 0!==a?f(a):m("Invalid id for Customer")}(t);if("delete"===p)return async function(t,a){const r=e.customers.findIndex((e=>e.id===t));return-1===r?m("Invalid id for Customer"):!1===await n.store(a)?{httpStatusCode:503,payload:{message:"localStorage is busy. Please try again later"}}:(e.customers.splice(r,1),f({}))}(t,g);if("patch"===p)return async function(t,a,r){const c=e.customers.findIndex((e=>e.id===t));if(-1===c)return m("Invalid id for customer");if(void 0===a)return l(0,"We must have at least a parameter to patch a customer");a.email&&(a.email=a.email.toLowerCase());for(let t in a)if("firstName"!==t&&"middleName"!==t&&"lastName"!==t&&"email"!==t&&"nationality"!==t&&"dateOfBirth"!==t&&"address"!==t&&"status"!==t)return l(0,"Invalid parameter in data",t);for(let t in a){const e=a[t];if("firstName"===t&&!1===u(e))return l(0,"Invalid Value for parameter",{i:e});if("lastName"===t&&!1===u(e))return l(0,"Invalid Value for parameter",{i:e});if("middleName"===t&&!1===u(e))return l(0,"Invalid Value for parameter",{i:e});if("email"===t&&!1===o(e))return l(0,"Invalid Value for parameter",{i:e});if("nationality"===t&&!1===i(e))return l(0,"Invalid Value for parameter",{i:e});if("dateOfBirth"===t&&!1===d(e))return l(0,"Invalid Value for parameter",{i:e});if("address"===t&&void 0===s(e))return l(0,"Invalid Value for parameter",{i:e});if("status"===t&&0==("created"===(p=e)||"active"===p||"inactive"===p))return l(0,"Invalid Value for parameter",{i:e})}var p;return!1===await n.store(r)?{httpStatusCode:503,payload:{message:"localStorage is busy. Please try again later"}}:(e.customers[c]={...e.customers[c],...a,updatedAt:n.getCurrentISODate()},f(e.customers[c]))}(t,y,g)}if("api.51bank.io/accounts"===I&&"get"===p)return f({objectType:"collection",contents:e.accounts});if("api.51bank.io/accounts"===I&&"post"===p)return async function(t,a){if(void 0===t)return l(0,"Missing all parameters to create a new account");const{customerId:i,type:o,offsetLimit:s}=t;if(void 0===i)return l(0,"Missing mandatory parameter ",{key:"customerId"});if(void 0===o)return l(0,"Missing mandatory parameter ",{key:"type"});if(void 0===e.customers.find((t=>t.id==i)))return l(0,"Invalid customerId to link to account ",{customerId:i});if("personal"!==o)return l(0,"parameter type can only be 'personal'");if(void 0!==s&&0==c(s))return l(0,"Invalid Parameter",{offsetLimit:s});const u=e.accounts.find((t=>t.customerId===i));if(void 0!==u)return l(0,"this customer has already an account ",{customerId:i});if(!1===await n.store(a))return{httpStatusCode:503,payload:{message:"localStorage is busy. Please try again later"}};const d="ac_"+r(),m=n.getCurrentISODate(),p={id:d,url:"https://api.51bank.io/accounts/"+d,objectType:"account",type:o,status:"created",createdAt:m,updatedAt:m,customerId:i,balance:0,currency:"USD",offsetLimit:void 0===s?1e4:+s};return e.accounts.push(p),f(p)}(y,g);if(I.startsWith("api.51bank.io/accounts/")){const t=I.substring(23);if("get"===p)return function(t){const a=e.accounts.find((e=>e.id===t));return void 0!==a?f(a):m("Invalid id for Account")}(t);if("delete"===p)return async function(t,a){const r=e.accounts.findIndex((e=>e.id===t));return-1===r?m("Invalid id for Account"):!1===await n.store(a)?{httpStatusCode:503,payload:{message:"localStorage is busy. Please try again later"}}:(e.accounts.splice(r,1),f({}))}(t,g);if("patch"===p)return async function(t,a,r){const i=e.accounts.findIndex((e=>e.id===t));if(-1===i)return m("Invalid id for account");if(void 0===a)return l(0,"Missing parameters to patch an account");for(let t in a)if("status"!==t&&"offsetLimit"!==t)return l(0,"Invalid parameter in data",t);return void 0!==a.offsetLimit&&0==c(a.offsetLimit)?l(0,"Invalid Parameter",{offsetLimit:a.offsetLimit}):!1===await n.store(r)?{httpStatusCode:503,payload:{message:"localStorage is busy. Please try again later"}}:(e.accounts[i]={...e.accounts[i],...a,updatedAt:n.getCurrentISODate()},f(e.accounts[i]))}(t,y,g)}if("api.51bank.io/payments"===I&&"get"===p)return f({objectType:"collection",contents:e.payments});if("api.51bank.io/payments"===I&&"post"===p)return async function(t,a){if(void 0===t)return l(0,"Missing all parameters to create a new payment");const{debtorId:i,creditorId:o,amount:s,currency:u,idempotencyKey:d}=t;if(void 0===i)return l(0,"Missing mandatory parameter",{debtorId:i});if(void 0===o)return l(0,"Missing mandatory parameter",{creditorId:o});if(void 0===s)return l(0,"Missing mandatory parameter",{amount:s});if(void 0===u)return l(0,"Missing mandatory parameter",{currency:u});if(void 0===d)return l(0,"Missing mandatory parameter",{idempotencyKey:d});const m=e.accounts.find((t=>t.id===i)),p=e.accounts.find((t=>t.id===o));if(void 0===m)return l(0,"Failed to find account for debtorId",{debtorId:i});if(void 0===p)return l(0,"Failed to find account for creditorId",{creditorId:o});if(i===o)return l(0,"Same identifier for debtor and creditor",{debtorId:i,creditorId:o});if(void 0!==e.payments.find((t=>t.idempotencyKey===d)))return l(0,"IdempotencyKey previously used",{idempotencyKey:d});if(!1===c(s))return l(0,"Invalid amount",{amount:s});if(u!==m.currency)return l(0,"Invalid Currency for debtor",{currency:u,accountDebtorCurrency:m.currency});if(u!==p.currency)return l(0,"Invalid Currency for creditor",{currency:u,accountCreditorCurrency:p.currency});if(!1===await n.store(a))return{httpStatusCode:503,payload:{message:"localStorage is busy. Please try again later"}};const y="pa_"+r(),g=n.getCurrentISODate(),I={id:y,url:"https://api.51bank.io/payments/"+y,objectType:"payment",type:"bookTransfer",status:"created",createdAt:g,updatedAt:g,debtorId:i,creditorId:o,currency:u,amount:s,idempotencyKey:d},S=+s;return m.balance-=S,p.balance+=S,e.payments.push(I),f(I)}(y,g);if(I.startsWith("api.51bank.io/payments/")){const t=I.substring(23);if("get"===p)return function(t){const a=e.payments.find((e=>e.id===t));return void 0!==a?f(a):m("Invalid id for Payment")}(t);if("patch"===p)return async function(t,a,r){const i=e.payments.findIndex((e=>e.id===t));if(-1===i)return m("Invalid id for payment");if(void 0===a)return l(0,"Missing parameters to patch a payment");for(let t in a)if("status"!==t)return l(0,"Invalid parameter in data",t);return"created"!==e.payments[i].status||"completed"!==a.status?l(0,"Invalid Flow for payment status update",{currentStatus:e.payments[i].status,proposedStatus:a.status}):!1===await n.store(r)?{httpStatusCode:503,payload:{message:"localStorage is busy. Please try again later"}}:(e.payments[i]={...e.payments[i],...a,updatedAt:n.getCurrentISODate()},f(e.payments[i]))}(t,y,g)}return l(0,"Unsupported Method, URL pair",{method:p,url:a})};return{executeRequest:p,getLSLoader:function(){async function t(t){const{text:e,timestamp:r}=JSON.parse(t),i=a(e);n.setTimeMachineOn(r);await p(i);n.setTimeMachineOff()}let e=0;const r=localStorage.length-1;return{length:r,next:async function(){if(t(localStorage.getItem(e)),e++,e===r){window.addEventListener("storage",(e=>{if("lock"!==e.key)if(null!==e.key){if(null!=e.oldValue)throw console.log("System is broke !!!"),"";t(e.newValue),console.log("This page has been notified of a change in storage and synch-ed up ")}else console.log("wow resetting")}));const a=localStorage.length-1;for(;e<a;e++)console.log("Catching up with an event which occurred while synching up. Event n."+e),t(localStorage.getItem(e))}}}}}};